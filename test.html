<html>

<head>
	<link type="text/css" rel="stylesheet" href="stylesheet.css">
	<script src='https://code.jquery.com/jquery-3.1.0.min.js'></script>
</head>

<body>

	<script>
		var gridSizeX = 8;
		var gridSizeY = 8;
		var totalBombs = 0;


		function drawPage() {
			$("body").append("<div id='boxContainer'>");
			var boxContainer = document.getElementById("boxContainer");


			//Generate grid.
			for (var y = 0; y < gridSizeY; y++)
				for (var x = 0; x < gridSizeX; x++) {
					var rand = Math.floor(Math.random() * 100);
					//20% chance could generate a bomb on generated square.
					if (rand <= 20) {
						$(boxContainer).append("<div class='bomb' id='" + x + "," + y + "'></div>");
						totalBombs++;
					} else {
						$(boxContainer).append("<div class='box' id='" + x + "," + y + "'></div>");
					}
				}
			console.log("Total bombs: " + totalBombs);
		}

		function checkWin() {
			var flags = document.getElementsByClassName("bomb flag");
			var checked = document.getElementsByClassName("box alive");

			console.log("Total flags: " + flags.length);
			console.log("Total checked: " + checked.length);
			console.log("Boxs to check: " + (gridSizeX * gridSizeY - totalBombs));
			if (flags.length == totalBombs && (gridSizeX * gridSizeY - totalBombs) == checked.length)
				alert("You win!");
		}


		function checkBombs(xStart, yStart, box) {
			if (!$(box).hasClass("alive") && !$(box).hasClass("bomb")) {
				var bombCount = 0; //Keep track of bombs around clicked square.

				xStart = parseInt(xStart);
				yStart = parseInt(yStart);

				var xCoord = parseInt(xStart - 1);
				var yCoord = parseInt(yStart - 1);

				if (xStart + 1 > gridSizeY || yStart + 1 > gridSizeX)
					return;
				if (xStart == 0)
					xCoord++;
				if (yStart == 0)
					yCoord++;

				for (var x = xCoord; x <= xStart + 1; x++)
					for (var y = yCoord; y <= yStart + 1; y++) {
						var boxElement = document.getElementById(x + "," + y);
						if ($(boxElement).hasClass("bomb"))
							bombCount++;

					}

				$(box).addClass("alive");
				$(box).append("<p class='bombCount" + bombCount + "'>" + bombCount + "</p>");
				$(".bombCount0").parent(box).css("background-color", "darkgreen");

				if (bombCount == 0) {
					for (var x = xCoord; x <= xStart + 1; x++)
						for (var y = yCoord; y <= yStart + 1 + 2; y++) {
							var boxElement = document.getElementById(x + "," + y);
							if (!$(boxElement).hasClass("alive"))
								checkBombs(x, y, boxElement);
						}
				}
			}
		}



		$(document).ready(function() {
			drawPage();

			//toggles press double click.
			$(".bomb").dblclick(function() {
				$(this).addClass("die");
				alert("You lose!");
			});


			//If normal box clicked.
			$(".box").dblclick(function() {

				//Get coords of square number that was clicked.
				var checkSquare = this.id.split(",");

				checkBombs(checkSquare[0], checkSquare[1], this);
				checkWin();
			});

			//flag on click.
			$(".bomb, .box").click(function() {
				if (!$(this).hasClass("alive")) {
					$(this).toggleClass("flag");
					checkWin();
				}
			});
		});

	</script>
</body>

</html>
