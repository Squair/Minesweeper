<html>
<head>


<link type="text/css" rel="stylesheet" href="stylesheet.css">
<script src='https://code.jquery.com/jquery-3.1.0.min.js'></script>
	
</head>
<body>
	
<script>  
		
	var gridSizeX = 8;
	var gridSizeY = 8;
	var totalBombs = 0;
	
    function hasClass(element, cls) {
    	return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
    }   
		
    function drawPage(){
		$("body").append("<div id='boxContainer'>");
		var boxContainer = document.getElementById("boxContainer");
		
		//Generate grid.
		for (var y = 0; y < gridSizeY; y++)
			for (var x = 0; x < gridSizeX; x++)
			{
			  var rand = Math.floor(Math.random() * 100);
			  //20% chance could generate a bomb on generated square.
			  if (rand <= 20)
			  {
				$(boxContainer).append("<div class='bomb' id='" + x + "," + y + "'><img></div>");  
				totalBombs++;
			  } else {
				$(boxContainer).append("<div class='box' id='" + x + "," + y + "'><img></div>");  
			  }
			}
		console.log("Total bombs: " + totalBombs);
    }
	
	function checkWin(){
		var flags = document.getElementsByClassName("bomb flag");
		
		console.log("Total flags: " + flags.length);
		if (flags.length == totalBombs)
			alert("You win!");
	}
	
$(document).ready(function(){
    drawPage();
    
    //toggles press double click.
    $(".bomb").dblclick(function(){
        $(this).addClass("die");
        alert("You lose!");
    });

    
    //If normal box clicked.
    $(".box").dblclick(function(){
        $(this).addClass("alive");
        //Get coords of square number that was clicked.
        var checkSquare = this.id.split(",");
		
        var bombCount = 0; //Keep track of bombs around clicked square.

		var xCoord = parseInt(checkSquare[0] - 1);
		var yCoord = parseInt(checkSquare[1] - 1);

        for (var x = xCoord; x <= xCoord + 2; x++)
			for (var y = yCoord; y <= yCoord + 2; y++)
			{
				var boxElement = document.getElementById(x + "," + y);
				if ($(boxElement).attr("class") === "bomb")
					bombCount++;
			}
		
        $(this).append(bombCount);
    });
    
    //flag on click.
    $(".bomb, .box").click(function(){
        $(this).toggleClass("flag");
        checkWin();
    });
});    
    
</script>
</body>
</html>